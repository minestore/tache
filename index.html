<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Tache by thelucid</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Tache</h1>
        <p>Full Mustache implementation with 'safe views' for end user applications.</p>

        <p class="view"><a href="https://github.com/thelucid/tache">View the Project on GitHub <small>thelucid/tache</small></a></p>


        <ul>
          <li><a href="https://github.com/thelucid/tache/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/thelucid/tache/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/thelucid/tache">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="tache" class="anchor" href="#tache"><span class="octicon octicon-link"></span></a>Tache</h1>

<h2>
<a name="full-mustache-implementation-plus-safe-views" class="anchor" href="#full-mustache-implementation-plus-safe-views"><span class="octicon octicon-link"></span></a>Full Mustache implementation plus 'safe views'.</h2>

<p>Tache is a <strong>fully spec-compliant <a href="http://mustache.github.com/">Mustache</a> implementation</strong> with the <em>addition</em> of 'safe views' for end user applications.</p>

<p>Safe views allow Tache templates to be edited by end users, without the risk jeopardising your application's security. When using safe views, only explicitly allowed methods are ever invoked and therefore calls to potentially destructive methods such as 'eval' or 'destroy' are ignored.</p>

<h4>
<a name="now-with-rubymotion-support" class="anchor" href="#now-with-rubymotion-support"><span class="octicon octicon-link"></span></a>Now with RubyMotion support.</h4>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Tache's safe views are an opt-in feature, so Tache will behave just as you'd expect a standard Mustache implementation to behave, unless <em>you</em> say otherwise.</p>

<h3>
<a name="standard-views" class="anchor" href="#standard-views"><span class="octicon octicon-link"></span></a>Standard Views</h3>

<p>Quick example:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'tache'</span>

<span class="no">Tache</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">'Hello {{planet}}'</span><span class="p">,</span> <span class="s1">'planet'</span> <span class="o">=&gt;</span> <span class="s1">'World'</span><span class="p">)</span>

<span class="o">=&gt;</span> <span class="s2">"Hello World"</span>
</pre></div>

<p>Please note that all hash keys must be defined as strings when working with any Tache view. This minimises the risk of memory leaks caused by symbols when used in an end-user environment and is therefore a general requirement of Tache, regardless of whether or not you are using safe views.</p>

<p>Here's another way of doing things (no real departure from standard Mustache):</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">MyView</span> <span class="o">&lt;</span> <span class="no">Tache</span>
  <span class="k">def</span> <span class="nf">planet</span>
    <span class="s1">'World'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">star</span>
    <span class="s1">'*'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">stars</span>
    <span class="n">star</span> <span class="o">*</span> <span class="mi">5</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">view</span> <span class="o">=</span> <span class="no">MyView</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">"{{planet}} (rating: {{stars}})"</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">render</span>
</pre></div>

<p>Result:</p>

<pre><code>World (rating: *****)
</code></pre>

<h3>
<a name="safe-views" class="anchor" href="#safe-views"><span class="octicon octicon-link"></span></a>Safe Views</h3>

<p>In order make use of Tache's safe views, you simply use <code>Tache::Safe</code> instead:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'tache/safe'</span>

<span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">'Hello {{planet}}'</span><span class="p">,</span> <span class="s1">'planet'</span> <span class="o">=&gt;</span> <span class="s1">'World'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"Hello World"</span>
</pre></div>

<p>The first thing you will notice about safe views (other than them looking a lot like unsafe views), is that only values that have been explicitly exposed via safe view methods will be invoked. Therefore anything that has not been explicitly exposed will not be invoked or output to the rendered template:</p>

<div class="highlight highlight-ruby"><pre><span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">'Hello {{planet.inspect}}'</span><span class="p">,</span> <span class="s1">'planet'</span> <span class="o">=&gt;</span> <span class="s1">'World'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"Hello "</span>
</pre></div>

<p>Another example, this time subclassing <code>Tache::Safe</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">MySafeView</span> <span class="o">&lt;</span> <span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span>
  <span class="k">def</span> <span class="nf">thing</span>
    <span class="s1">'World'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">present</span>
    <span class="s2">"I'm here!"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">bold</span>
    <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">text</span><span class="o">|</span>
      <span class="s1">'&lt;b&gt;'</span> <span class="o">+</span> <span class="n">render</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'&lt;/b&gt;'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Template:</p>

<pre><code>Hello {{thing}}, here's safe view in action:

self            -&gt; {{.}}
inspect         -&gt; {{inspect}}
to_sym          -&gt; {{to_sym}}
thing           -&gt; {{thing}}
present         -&gt; {{present}}
present.upcase  -&gt; {{present.upcase}}

Bold: {{#bold}}{{thing}}{{/bold}}
</code></pre>

<p>Render:</p>

<div class="highlight highlight-ruby"><pre><span class="n">view</span> <span class="o">=</span> <span class="no">MySafeView</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">render</span>
</pre></div>

<p>Result:</p>

<pre><code>Hello World, here's safe view in action:

self            -&gt; 
inspect         -&gt; 
to_sym          -&gt; 
thing           -&gt; World
present         -&gt; I'm here!
present.upcase  -&gt; 

Bold: &lt;b&gt;World&lt;/b&gt;
</code></pre>

<p>Notice how lambda's still work just as you'd expect but only explicitly exposed values are in the rendered output.</p>

<p>So, what if we want to expose something other than hash values or view object methods to our templates? Just subclass <code>Tache::Safe</code> and you're good to go, it's turtles all the way down:</p>

<p>Example:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Product</span>
  <span class="k">def</span> <span class="nf">title</span>
    <span class="s1">'iPhone'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">price</span>
    <span class="mi">399</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="s1">'Deleted product from database!'</span>
  <span class="k">end</span>

  <span class="c1"># Returns product from database</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first</span>
    <span class="no">Product</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">ProductView</span> <span class="o">&lt;</span> <span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="n">product</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">title</span>
    <span class="vi">@product</span><span class="o">.</span><span class="n">title</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">price</span>
    <span class="s2">"$</span><span class="si">#{</span><span class="vi">@product</span><span class="o">.</span><span class="n">price</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CartView</span> <span class="o">&lt;</span> <span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span>
  <span class="k">def</span> <span class="nf">product</span>
    <span class="no">ProductView</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Product</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Template:</p>

<pre><code>Product price: {{product.price}}
Trying to destroy: {{product.destroy}}

{{^destroy}}Bad luck hacker!{{/destroy}}
</code></pre>

<p>Render:</p>

<div class="highlight highlight-ruby"><pre><span class="n">view</span> <span class="o">=</span> <span class="no">CartView</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">render</span>
</pre></div>

<p>Result:</p>

<pre><code>Product price: $399
Trying to destroy: 

Bad luck hacker!
</code></pre>

<h3>
<a name="safe-view-shortcut" class="anchor" href="#safe-view-shortcut"><span class="octicon octicon-link"></span></a>Safe view shortcut</h3>

<p>It can become monotonous having to create a safe view class for any object you would like to expose to a template, therefore Tache also provides a shortcut for creating safe views from existing objects.</p>

<p>Simply include the <code>Tache::Safe::Auto</code> module and call the <code>tache</code> class method, supplying it with a list of methods you would like to be available in your templates and Tache will dynamically create a safe view for you behind the scenes:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span><span class="o">::</span><span class="no">Auto</span>

  <span class="n">tache</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:occupation</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="s1">'Jamie'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">occupation</span>
    <span class="s1">'Developer'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">age</span>
    <span class="s2">"Don't ask"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Template</p>

<pre><code>{{#person}}
Name: {{name}}
Occupation: {{occupation}}
Age: {{age}}
{{/person}}
</code></pre>

<p>Render</p>

<div class="highlight highlight-ruby"><pre><span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span> <span class="p">})</span>
</pre></div>

<p>Result</p>

<pre><code>Name: Jamie
Occupation: Developer
Age: 
</code></pre>

<h3>
<a name="compiled-templates-and-partials" class="anchor" href="#compiled-templates-and-partials"><span class="octicon octicon-link"></span></a>Compiled templates and partials</h3>

<p>Proper documentation on compiled templates and partials coming soon! For now, just see the code (it's pretty straight forward):</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Compiled</span>
<span class="n">compiled</span> <span class="o">=</span> <span class="no">MyView</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'Hello {{thing}}'</span><span class="p">)</span>
<span class="n">compiled</span><span class="o">.</span><span class="n">render</span>

<span class="c1"># Partials</span>
<span class="ss">Tache</span><span class="p">:</span><span class="ss">:Safe</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">'Hello {{&gt;partial}}'</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'a'</span> <span class="o">=&gt;</span> <span class="s1">'b'</span> <span class="p">},</span> <span class="p">{</span> <span class="s1">'partial'</span> <span class="o">=&gt;</span> <span class="s1">'World'</span> <span class="p">})</span>

<span class="c1"># Both</span>
<span class="n">compiled</span> <span class="o">=</span> <span class="no">MyView</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'Hello {{&gt;partial}}'</span><span class="p">)</span>
<span class="n">compiled</span><span class="o">.</span><span class="n">partials</span><span class="o">[</span><span class="s1">'partial'</span><span class="o">]</span> <span class="o">=</span> <span class="err">'</span><span class="no">World</span>
<span class="n">compiled</span><span class="o">.</span><span class="n">render</span>
</pre></div>

<p>You can even precompile a punch of partials (they'll get compiled for you automatically anyway but handy to know):</p>

<div class="highlight highlight-ruby"><pre><span class="n">compiled</span> <span class="o">=</span> <span class="no">MyView</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'Hello {{&gt;partial1}}, {{&gt;partial2}}'</span><span class="p">)</span>
<span class="n">compiled</span><span class="o">.</span><span class="n">partials</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="s1">'partial1'</span> <span class="o">=&gt;</span> <span class="ss">Tache</span><span class="p">:</span><span class="ss">:Template</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'{{a.b.c}}'</span><span class="p">),</span>
  <span class="s1">'partial2'</span> <span class="o">=&gt;</span> <span class="ss">Tache</span><span class="p">:</span><span class="ss">:Template</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">'{{a.b.c.d}}'</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">compiled</span><span class="o">.</span><span class="n">render</span>
</pre></div>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<pre><code>gem 'tache'
</code></pre>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre><code>$ gem install tache
</code></pre>

<p>Note: Tache requires at least Ruby 1.9.</p>

<h3>
<a name="rubymotion" class="anchor" href="#rubymotion"><span class="octicon octicon-link"></span></a>RubyMotion</h3>

<p>As above, then just require it in your Rakefile:</p>

<pre><code>require 'tache'
</code></pre>

<h2>
<a name="testing" class="anchor" href="#testing"><span class="octicon octicon-link"></span></a>Testing</h2>

<p>Tests are written with Test::Unit and can be run with Guard:</p>

<pre><code>bundle
bundle exec guard   
</code></pre>

<h2>
<a name="acknowledgements" class="anchor" href="#acknowledgements"><span class="octicon octicon-link"></span></a>Acknowledgements</h2>

<p>Thanks to <a href="https://github.com/defunkt">Chris Wanstrath</a> for the original Ruby implementation and <a href="https://github.com/janl">Jan Lehnardt</a> for his JavaScript port (I took a great deal of inspiration, understanding and tests from this version).</p>

<p>Thanks also to the guys at <a href="https://github.com/Shopify">Shopify</a> for their <code>Liquid::Drop</code> inspiration and <a href="https://github.com/groue">Gwendal Roué</a> for putting up with my brainstorming on GitHub.</p>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/thelucid">thelucid</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>